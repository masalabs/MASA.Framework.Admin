@using Microsoft.AspNetCore.Components.Rendering
@inherits LayoutComponentBase
@inject GlobalConfig GlobalConfig
@implements IDisposable

<MApp>
    <MAppBar Elevation=0 App MaxHeight=60 Class="@($"{(GlobalConfig.PageMode == PageModes.PageTab ?"mx-6":"mx-6 rounded-b-4")}")">
        <Favorite />
        <MSpacer />
        <Search />
        <MIcon Size=20 Class="ml-5" Color="neutral-lighten-3">mdi-message-processing-outline</MIcon>
        <MIcon Size=20 Class="ml-5" Color="neutral-lighten-3" OnClick="()=> _showSetting = true">mdi-cog</MIcon>
        <Language />
        <Login />
    </MAppBar>

    <Navigation />

    <MMain Class="fill-lighten-1" Style="padding-top:60px">
        @if (GlobalConfig.PageMode == PageModes.Breadcrumb)
        {
            <div class="pa-6 max-width">
                <Breadcrumb></Breadcrumb>
                @Body
            </div>
        }
        else if (GlobalConfig.PageMode == PageModes.PageTab)
        {
            <PageTabs>
                @Body
            </PageTabs>
        }
        else
        {
            <MContainer Fluid Class="pa-6">
                @Body
            </MContainer>
        }
    </MMain>

     <PConfirm @bind-Visible="_confirm.Visible"
              Title="@_confirm.Title"
              Type="@_confirm.Type"
              Icon="@_confirm.Icon"
              IconColor="@_confirm.IconColor"
              OkText="@_confirm.OkText"
              CancelText="@_confirm.CancelText"
              OkColor="@_confirm.OkColor"
              CancelColor="@_confirm.CancelColor"
              OnOk="_confirm.OnOk"
              OnCancel="_confirm.OnCancel">
        @_confirm.Content
    </PConfirm>

    <Message @bind-Value="_message.Visible" Timeout="_message.Timeout" Type="_message.Type">
        @_message.Content
    </Message>

    <Settings @bind-Show=_showSetting />
</MApp>

@code {

    private bool _showSetting;

    protected override void OnInitialized()
    {
        GlobalConfig.OnPageModeChanged += base.StateHasChanged;
    }

    public void Dispose()
    {
        GlobalConfig.OnPageModeChanged -= base.StateHasChanged;
    }
}