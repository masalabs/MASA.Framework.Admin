@page "/blog-admin/category"
@inherits ProCompontentBase

<PPageHeader Title="搜索" ShowFiltersByDefault OnSearch="() => FetchList()">
    <LeftActions>
        <MButton Color="primary" OnClick="AddAsync"><MIcon Left>mdi-plus</MIcon>新增</MButton>
    </LeftActions>
    <Filters Context="filter">
        <MRow Dense>
            <MCol Cols="12">
                <DefaultTextField Label="分类名称"
                                  @bind-Value="_options.TypeName"
                                  OnKeyDown="filter.onEnter"
                                  OnClearClick="filter.onSearch">
                </DefaultTextField>
            </MCol>
        </MRow>
    </Filters>
</PPageHeader>

<DefaultDataTable Headers="_headers"
                  Items="_tableData"
                  Loading="_loading"
                  OnOptionsUpdate="HandleOnOptionsUpdate"
                  Page="_options.PageIndex"
                  ItemsPerPage="_options.PageSize"
                  ServerItemsLength="_totalCount"
                  TItem="BlogTypePagingViewModel">
    <ItemColContent>
        @if (context.Header.Value == "actions")
        {
            <PAction Color="primary" Label="编辑" Text OnClick="() => UpdateAsync(context.Item)" Icon="mdi-pencil"> </PAction>
            <PAction Color="error" Label="删除" Text OnClick="() => DialogAsync(context.Item)" Icon="mdi-delete"></PAction>
        }
        else
        {
            <GenericColumnRender Value="@context.Value" ChippedEnum></GenericColumnRender>
        }


    </ItemColContent>
</DefaultDataTable>

<FormModal Visible="@_dataModal.Visible" Width="600" Title="@_dialogTitle" OnCancel="() => _dataModal.Hide()" OnOk="Save" Model="_dataModal.Data">
    <MRow>
        <MCol Cols="12">
            <MTextField Label="名称"
                        Dense Outlined
                        @bind-Value="_dataModal.Data.TypeName">
                <PrependInnerContent>
                    <lable class="red--text">*</lable>
                </PrependInnerContent>
            </MTextField>
        </MCol>
    </MRow>
</FormModal>

<MSnackbar @bind-Value="_show" MultiLine Top Outlined>
    <ChildContent>
        @_message
    </ChildContent>
    <ActionContent>
        <MButton Color="@_color"
                 Text
                 OnClick="()=>_show = false">
            Close
        </MButton>
    </ActionContent>
</MSnackbar>

<MDialog @bind-Value="_dialog"
         Persistent
         Width="500">
    <ChildContent>
        <MCard>
            <MCardTitle>
                删除文章类型
            </MCardTitle>
            <MCardText>您确认要删除吗?</MCardText>
            <MCardActions>
                <MSpacer></MSpacer>
                <MButton Color="green darken-1"
                         Text
                         OnClick="() => _dialog = false">
                    取消
                </MButton>
                <MButton Color="green darken-1"
                         Text
                         OnClick="()=>DelAsync()">
                    确定
                </MButton>
            </MCardActions>
        </MCard>
    </ChildContent>
</MDialog>