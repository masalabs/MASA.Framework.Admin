@page "/blog-admin/advertising-picture"
@namespace MASA.Framework.Admin.Blog.Pages.BlogAdmin
@using MASA.Framework.Admin.Contracts.Blogs.BlogAdvertisingPictures.Enums
@using Microsoft.AspNetCore.Components
@using Action = MASA.Blazor.Experimental.Components.Action;
@inherits ProCompontentBase

<PPageHeader Title="搜索" ShowFiltersByDefault OnSearch="() => FetchList()">
    <LeftActions>
        <MButton Color="primary" OnClick="Create"><MIcon Left>mdi-plus</MIcon>新增</MButton>
    </LeftActions>
    <Filters Context="filter">
        <MRow Dense>
            <MCol Cols="12">
                <DefaultSelect Label="类型"
                               Items="Enum<BlogAdvertisingPicturesTypes>.GetEnumObjectList<BlogAdvertisingPicturesTypes>()"
                               ItemText="item => item.Name"
                               ItemValue="item => item.Value"
                               @bind-Value="_options.Type"
                               TItem="EnumObject<BlogAdvertisingPicturesTypes>"
                               TValue="BlogAdvertisingPicturesTypes?"
                               TItemValue="BlogAdvertisingPicturesTypes"
                               OnSelectedItemUpdate="filter.onSearch"
                               OnClearClick="filter.onSearch">
                </DefaultSelect>
            </MCol>
        </MRow>
    </Filters>
</PPageHeader>

<DefaultDataTable Headers="_headers"
                  Items="_tableData"
                  Loading="_loading"
                  OnOptionsUpdate="HandleOnOptionsUpdate"
                  Page="_options.PageIndex"
                  ItemsPerPage="_options.PageSize"
                  ServerItemsLength="_totalCount"
                  TItem="BlogAdvertisingPicturesListViewModel">
    <ItemColContent>
        @if (context.Header.Value == nameof(BlogAdvertisingPicturesListViewModel.Pic))
        {
            <MImage MaxHeight="42" Src="@context.Item.Pic"></MImage>
        }
        else if (context.Header.Value == "Actions")
        {
            <Actions>
                <Action Color="primary"
                        Icon="mdi-pencil-outline"
                        Label="编辑"
                        OnClick="() => Modify(context.Item)"></Action>
                <Action Color="error"
                        DisableAutoLoading
                        Icon="mdi-delete-outline"
                        Label="删除"
                        OnClick="() => RemoveAsync(context.Item)"></Action>
            </Actions>
        }
        else
        {
            <DefaultGenericColumnRender BoolRender="@(v => v ? "开启" : "关闭")" Value="@context.Value" ChippedEnum></DefaultGenericColumnRender>
        }
    </ItemColContent>
</DefaultDataTable>

<FormModal Visible="_dataModal.Visible"
           Model="_dataModal.Data"
           Title="@DataModalTitle"
           Width="500"
           OnCancel="_dataModal.Hide"
           OnOk="CreateOrUpdateAsync">
    <MRow>
        <MCol Cols="12">
            <DefaultTextField TValue="string"
                              Label="标题"
                              @bind-Value="_dataModal.Data.Title" />
        </MCol>
        <MCol Cols="12">
            <DefaultTextField TValue="string"
                              Label="图片地址"
                              @bind-Value="_dataModal.Data.Pic" />
        </MCol>
        <MCol Cols="12">
            <DefaultAutoComplete Label="类型"
                                 Items="Enum<BlogAdvertisingPicturesTypes>.GetEnumObjectList<BlogAdvertisingPicturesTypes>()"
                                 ItemText="item => item.Name"
                                 ItemValue="item => item.Value"
                                 @bind-Value="_dataModal.Data.Type"
                                 TItem="EnumObject<BlogAdvertisingPicturesTypes>"
                                 TValue="BlogAdvertisingPicturesTypes"
                                 TItemValue="BlogAdvertisingPicturesTypes">
            </DefaultAutoComplete>
        </MCol>
        <MCol Cols="12">
            <DefaultTextField TValue="int"
                              Label="排序值"
                              @bind-Value="_dataModal.Data.Sort" />
        </MCol>
        <MCol Cols="12">
            <DefaultSwitch Label="是否启用"
                           @bind-Value="_dataModal.Data.Status" />
        </MCol>
    </MRow>
</FormModal>